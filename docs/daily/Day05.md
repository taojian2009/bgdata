### 1. ODS层

主要目的： 主要同步原始数据

#### 全量覆盖

--全量表 [快照表] --维度表

#### 新增同步

--增量表 -- 事实表

#### 新增和更新

新增和更新 --拉链表 -- 事实表 分区表：每天将新增和更新的数据按天为分区存储 拉链表；

依靠create_time, update_time;

创建时间和更新时间均在当前时间窗口内。

#### 完整数据同步

更改sqoop脚本，然后定时跑脚本即可。 全量采集表：ods_full_table.txt 增量采集表: ods_incr_new_tables.txt 新增及更新表: ods_incr_update_tbname.txt

ODS的目的，在于同步原始数据，data ingestion. 工作中可能需要自动化建表； 主要如何通过写sqoop脚本，采集数据；

### 2. DWD层

主要目的：

+ 主要通过清洗抓换，获得明细数据；
+ 划分事实表和维度表
+ 着重于存储
+ 保证数据质量

如何划分事实表和维度表；

#### 数据导入：

+ 维度表： 全量覆盖


+ 新增表： 分区增量


+ 拉链表： 增量和更新
    - 设置时间标记历史状态, start_date, end_date
    - ods按天抽取新增和更新的数据，存入ods当日的分区
    - dwd层设置start_date, end_date标记数据的有效时间；
    - end_date 其实是作为是否有效的筛选字段，也就是最新状态的筛选时间；

+ 如何构建拉链表
    1. 将昨天新增和更新的数据，采集到ods层昨天的分区中[start_date就是昨天的日期，也就是分区的时间]--ODS是增量表
    2. 将昨天新增和更新的数据与dwd层的拉链表进行合并，生成最新的拉链表，放入一张临时表中； --DWD是拉链表
        1. 数据表的合并： union vs union all有啥区别？
        2. 修改老的拉链表中本地更新的，将其end_date修改为本地的最新状态 - start_date -1
            1. 如何知道这条数据这次有没有更新控偶偶偶偶偶偶偶偶偶偶偶偶偶偶偶偶偶偶偶偶偶偶偶偶绿拖过≥œƒ®£†™¢
            2. 我怎么知道这条数据之前是最新状态，不是历史状态呢？
    3. end-date=9999-01-01, 且发生了更新（left join 不为）；

与ODS的区别：

+ ODS是抽取的时候不一样，ODS偏同步
+ DWD是存储的时候不一样，DWD偏存储

JJM JHH 使用union可以实现拉链表，也可以使用开窗开窗函数；

### 3.DWB

基础数据层；

+ 提前对数据进行处理钱的准备
+ 为了避免后面每次梳理数据都需要做join
+ 追求性能
+ 宽表是根据需求分析来的
+ 根据需求，梳理维度；

订单宽表--order 商品宽表--goods 店铺宽表--merchant 
                                                    